<%= render 'spree/admin/shared/product_tabs', current: Spree.t(:volume_pricing) %>
<%= render 'spree/shared/error_messages', target: @variant %>

<%= form_for(@variant, url: admin_product_variant_path(@product, @variant), html: { method: :put }) do |f| %>
  <div class="row m-1">
    <div class="border rounded bg-white w-100">
      <div class="card-header">
        <div class="row pb-0">
          <div class="col">
            <h5 class="card-title mb-0 h6"><%= Spree.t(:volume_prices) %></h5>
          </div>
          <div class="col">
            <div id="new_add_volume_price" class="float-right">
              <%= button_link_to Spree.t(:add_volume_price), 'javascript:;', {
                icon: 'add.svg', :'data-target' => 'tbody#volume_prices', class: 'btn-primary spree_add_fields', id: 'add_volume_price' } %>
            </div>
          </div>
        </div>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th><%= Spree.t(:name) %></th>
            <th><%= Spree.t(:pricing_tier) %></th>
            <th><%= Spree.t(:discount_type) %></th>
            <th><%= Spree.t(:range) %></th>
            <th><%= Spree.t(:amount) %></th>
            <th><%= Spree.t(:position) %></th>
            <th class="actions"></th>
          </tr>
        </thead>
        <tbody id="volume_prices">
          <%= f.fields_for :volume_prices do |vp_form| %>
            <tr class="volume_price fields">
              <td class="form-group">
                <%= vp_form.text_field :name, size: 10, class: 'form-control' %>
                <%= error_message_on(f.object, :name) %>
              </td>
              <td class="form-group">
                <%= error_message_on(f.object, :pricing_tier_id) %>
                <%= vp_form.collection_select(:pricing_tier_id, Spree::PricingTier.all, :id, :name, { include_blank: Spree.t('match_choices.none') }, { class: 'select2-clear' }) %>
              </td>
              <td class="form-group">
                <%= error_message_on(f.object, :discount_type) %>
                <%= vp_form.select :discount_type, [
                    ["#{Spree.t(:total_price)}", 'price'],
                    ["#{Spree.t(:percent_discount)}", 'percent'],
                    ["#{Spree.t(:price_discount)}", 'dollar']
                  ], { inlcude_blank: true }, class: 'select2' %>
              </td>
              <td class="form-group">
                <%= error_message_on(f.object, :range) %>
                <%= vp_form.text_field :range, size: 10, class: 'form-control' %>
              </td>
              <td class="form-group">
                <%= error_message_on(f.object, :amount) %>
                <%= vp_form.text_field :amount, size: 10, class: 'form-control' %>
              </td>
              <td class="form-group">
                <%= error_message_on(f.object, :position) %>
                <%= vp_form.text_field :position, size: 3, class: 'form-control' %>
              </td>
              <td>
                <%= vp_form.hidden_field :store_id, value: current_store.id %>
              </td>
              <td>
                <%= link_to_icon_remove_fields vp_form %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
  <%= render 'spree/admin/shared/edit_resource_links' %>
<% end %>
