<div class="border rounded bg-white">
  <div class="col-12">
    <div class="card-header">
      <div class="row pb-0">
        <div class="col">
          <h5><%= Spree.t(:volume_prices) %></h5>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12"> 
    <table class="table">
      <thead>
        <tr>
          <th><%= Spree.t(:name) %></th>
          <th><%= Spree.t(:pricing_tier) %></th>
          <th><%= Spree.t(:discount_type) %></th>
          <th><%= Spree.t(:range) %></th>
          <th><%= Spree.t(:amount) %></th>
          <th><%= Spree.t(:position) %></th>
          <th><%= Spree.t(:action) %></th>
        </tr>
      </thead>
      <tbody id="sortVert">
        <% build_volume_prices = @variant.volume_prices.where(store_id: current_store.id).any? ? @variant.volume_prices.where(store_id: current_store.id) : @variant.volume_prices.where(store_id: current_store.id).build %>

        <%= f.fields_for :volume_prices, build_volume_prices do |vp_form| %>
          <tr class="volume_price fields">
            <td class="form-group">
              <%= vp_form.text_field :name, size: 10, class: 'form-control' %>
              <%= error_message_on(f.object, :name) %>
            </td>

            <td class="form-group">
              <%= error_message_on(f.object, :pricing_tier_id) %>
              <%= vp_form.collection_select(:pricing_tier_id, Spree::PricingTier.all, :id, :name, { include_blank: Spree.t('match_choices.none') }, { class: 'form-control' }) %>
            </td>

            <td class="form-group">
              <%= error_message_on(f.object, :discount_type) %>
              <%= vp_form.select :discount_type, [
                  ["#{Spree.t(:total_price)}", 'price'],
                  ["#{Spree.t(:percent_discount)}", 'percent'],
                  ["#{Spree.t(:price_discount)}", 'dollar']
                ], { inlcude_blank: true }, class: 'form-control' %>
            </td>
            <td class="form-group">
              <%= error_message_on(f.object, :range) %>
              <%= vp_form.text_field :range, size: 10, class: 'form-control' %>
            </td>
            <td class="form-group">
              <%= error_message_on(f.object, :amount) %>
              <%= vp_form.text_field :amount, size: 10, class: 'form-control' %>
            </td>
            <td class="form-group">
              <%= error_message_on(f.object, :position) %>
              <%= vp_form.text_field :position, size: 3, class: 'form-control' %>
            </td>
           
            <%= vp_form.hidden_field :store_id, value: current_store.id, class: 'current-store-hidden-field' %>
            <td>
              <%= link_to_icon_remove_fields vp_form %>
            </td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="7">
            <div id="" class="d-flex" data-hook>
              <%= button_link_to Spree.t(:add_volume_price), "javascript:;", { icon: 'add.svg', :'data-target' => "tbody#sortVert", class: 'btn-primary mx-auto spree_add_fields' } %>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<script type="text/javascript">
  document.addEventListener("spree:load", function() {
    $('.spree_add_fields').click(function(e) {
      e.preventDefault();
      
      $('.current-store-hidden-field').val(<%= current_store.id %>)
    });
  });
</script>
